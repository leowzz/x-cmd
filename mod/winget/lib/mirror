# shellcheck shell=dash
___x_cmd_winget_mirror(){
    [ $# -gt 0 ]    ||  set - --help
    local op="$1";      shift
    case "$op" in
        set)        ___x_cmd_winget_mirror___set     "$@" ;;
        unset)      ___x_cmd_winget_mirror___unset   "$@" ;;
        ls)         ___x_cmd_winget_mirror___ls      "$@" ;;
        current)    ___x_cmd_winget_mirror___current "$@" ;;
        -h|--help)
                ___x_cmd help -m winget mirror ;;
        *)      ___x_cmd help -m winget mirror >&2; return 64 ;;
    esac
}

___x_cmd_winget_mirror___set(){
    [ $# -gt 0 ]    ||  set - ustc
    local name="$1"
    case "$name" in
        ustc)
            # https://mirrors.ustc.edu.cn/help/winget-source.html
            winget:info --Thanks "https://mirrors.ustc.edu.cn" "Set the USTC mirror source, which will replace the \"winget\" source"
            ___x_cmd pwsh admin "winget source remove winget; winget source add winget https://mirrors.ustc.edu.cn/winget-source"
            ;;
        msstore)
            winget:info "Set the official Microsoft software source for winget, which will replace the \"msstore\" source"
            ___x_cmd pwsh admin "winget source remove msstore; winget source add msstore https://storeedgefd.dsx.mp.microsoft.com/v9.0"
            ;;
        -h|--help)
            ___x_cmd help -m winget mirror set ;;
        *)  N=winget M="Only support [ustc] mirror now" log:ret:64
            ;;
    esac
}

___x_cmd_winget_mirror___unset(){
    winget:info "Unset the mirror source"
    ___x_cmd pwsh admin "winget source reset winget"
}

___x_cmd_winget_mirror___ls(){
    printf "%s\n" \
        "Code       Url                                         Name"                    \
        "ustc       https://mirrors.ustc.edu.cn/winget-source   USTC Mirror WinGet Software Source"
}

___x_cmd_winget_mirror___current(){
    ___x_cmd_winget___bin source list
}
